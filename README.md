# Apache Maven
**Apache Maven** - это фреймворк для автоматизации сборки проектов на основе описания их структуры в файлах на языке POM. Также Maven помогает управлять зависимостями и  предоставляет единую систему сборки проектов и составления необходимой информации о проекте.

## Архитипы и структура
При создании проекта мы выбираем его архитип, то есть шаблон по которому будет создаваться наш проект. Такая стандартизация позволяет разработчикам легко ориентироваться в любом проекте. 
После создания проекта по архитипу quick-start можно увидеть следующую структуру каталогов:
```
my-app
|-- pom.xml
`-- src
    |-- main
    |   `-- java
    |       `-- com
    |           `-- mycompany
    |               `-- app
    |                   `-- App.java
    `-- test
        `-- java
            `-- com
                `-- mycompany
                    `-- app
                        `-- AppTest.java
```

Итак созданный проекта состоит из каталога src/main/java, где лежат все java-классы нашего проекта, src/test/java c исходниками для юнит-тестирования и также файла pom.xml.

## POM 
**POM (объектная модель проекта)** - это основная единица работы с Maven, управление которого ведется из файла pom.xml. Этот файл состоит из:
- Project coordinates (groupId, artifactId, version) — однозначно идентифицируемый набор свойств, с помощью которых артефакты проекта могут быть использованы в другом месте 
- Dependencies — библиотеки, необходимые для сборки проекта (Чтобы добавить внешнюю библиотеку в проект, нужно поместить в pom.xml в тег <dependencies> проектные координаты данной библиотеки)
- Plugins — вспомогательные инструменты при сборке проекта (Чтобы добавить Мавен-плагин в проект, его описание, аналогично зависимостям, нужно поместить в pom.xml в тег <build> и <plugins>)
- Properties — общие значения, необходимые проекту

## Build Lifecycle или цикл создания проекта
Сборка любого Maven-проекта состоит из трех основных этапов: 
- default (развертывание проекта)
- clean (очистка проекта)
- site (создание документации проекта)

Также каждый из этих этапов разделяется на более мелкий фазы. Например, жизненный цикл default состоит из следующих фаз:
1. validate - проверка правильности проекта и наличия всей необходимой информации
2. compile - компилирование исходного кода проекта
3. test - тестирование скомпилированного кода с помощью юнит-тестирования.
4. package - упаковка скомпилированного кода в выбранный формат, например, в JAR или ZIP. (артефакт сохраняется в созданном при первой упаковке каталоге target)
5. verify - интеграционное тестирование
6. install - установка артефакта в локальный репозиторий для использования в качестве зависимости в других проектах локально
7. deploy - загрузка окончательного артефакта в удаленный репозиторий для совместного использования с другими разработчиками и проектами.

Запуска фаз можно осуществлять через консоль командой `mvn <название фазы>` или в специальном окне Maven в Intellij IDEA.

## Исполняемые файлы jar
Чтобы ваш артефакт в виде java-архива исполнялся необходимо его упаковать в исполняемом файле jar, то есть файл META-INF/MANIFEST.MF должен указывать на класс, реализующий метод main(). Это можно сделать при помощи разных плагинов. 
Рассмотрим один из них - плагин Apache Maven Shade. При помощи его мы можем упаковать артефакт в uber-jar. 
Для этого необходимо добавить в pom.xml - файле следующее:
```
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-shade-plugin</artifactId>
    <version>3.4.1</version>
    <executions>
        <execution>
            <goals>
                <goal>shade</goal>
            </goals>
            <configuration>
                <shadedArtifactAttached>true</shadedArtifactAttached>
                <transformers>
                    <transformer implementation=
                      "org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                        <mainClass>"Путь к классу реализующий метод main()"</mainClass>
                </transformer>
            </transformers>
        </configuration>
        </execution>
    </executions>
</plugin>
```
Обязательно в теге <mainClass> указать путь к классу реализующий метод main().

После упаковки проекта с этим плагином наш артефакт будет иметь суффикс -shaded.
Чтобы выполнить наш артефакт необходимо в консоли прописать следующую команду
`java -jar <название uber-jar артефакта>`